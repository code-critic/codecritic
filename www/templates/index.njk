<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <title>ADA 2018-2019</title>
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
      <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css" rel="stylesheet">
      {# <link href="https://mdbootstrap.com/wp-content/themes/mdbootstrap4/css/compiled-4.5.9.min.css?ver=4.5.9" rel="stylesheet"> #}
      <link href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.5.10/css/mdb.min.css" rel="stylesheet">
      <link rel="stylesheet" href="https://getbootstrap.com/docs/4.1/assets/css/docs.min.css">
      <link rel="stylesheet" href="/static/css/main.css">
      
   </head>
   <body>
     
     <div class="container-fluid">
       <div class="row flex-xl-nowrap">
         <div class="bd-content">
           <div class="row" id="charts-sm">

              <div class="col-xs-12 col-sm-10 col-lg-8 m-auto">
                
                <div class="card grey lighten-3">
                  <div class="card-image mb-3 rounded-top" style="background-image: url('/static/imgs/intro.jpeg');">
                    <div class="text-white align-items-center rgba-blue-strong p-4 rounded-top">
                      <h3 class="card-title m-0 text-white">ADA 2018</h3>
                    </div>
                  </div>
                  
                  <div class="card-body p-0">
                    
                    <div class="row px-5 pt-0 pb-5">
                      <div class="col-12 col-md-7">
                        <form class="form" action="/process" method="post">
                          <h3>Odevzdání řešení</h3>
                          <!-- Problem -->
                          <label>Název úlohy</label>
                          <select class="browser-default custom-select mb-4 prob-select" name="prob-id">
                            {% for id, prob in problems %}
                              <option value="{{ id }}">{{ prob.name }}</option>
                            {% endfor %}
                          </select>
                          
                          <!-- Prog language -->
                          <label>Programovací jazyk</label>
                          <select class="browser-default custom-select mb-4 lang-select" name="lang-id">
                            {% for id, lang in languages %}
                              <option value="{{ id }}">{{ lang.name }}</option>
                            {% endfor %}
                          </select>
                          
                          
                          <!-- Source code -->
                          <div class="form-group mb-4">
                            <label for="srcTA">Zdrojový kód</label>
                            <textarea class="form-control smaller text-monospace" name="src" id="srcTA" rows="15" placeholder="Vložte zdrojový kód" required></textarea>
                          </div>
                          
                          <hr />
                          
                          <!-- E-mail address -->
                          <div class="form-group mb-4">
                            <label for="email">E-mailová adresa</label>
                            <input type="email" class="form-control" id="email" name="email" placeholder="jmeno.prijmeni@tul.cz" required>
                            <div class="invalid-feedback">
                              Zadejte e-mailovou adresu v doméně <strong>tul.cz</strong>
                            </div>
                          </div>
                          

                          <!-- Send button -->
                          <button class="btn btn-info btn-block submit-button" type="submit">Odeslat</button>
                        </form>
                      </div>
                      
                      <div class="col-12 col-md-5">
                        {% for id, prob in problems %}
                          <div class="d-none prob-desc" id="desc-{{ id }}">
                            <h3>Zadání pro úlohu <code>{{ prob.name }}</code></h3>
                            {{ prob.description }}
                          </div>
                        {% endfor %}
                      </div>
                    </div>
                    
                  </div>
                </div>
              </div>
           </div>
         </div>
       </div>
     </div>
     
   </body>
   <!-- JQuery -->
   <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
   <!-- Bootstrap tooltips -->
   <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.13.0/umd/popper.min.js"></script>
   <!-- Bootstrap core JavaScript -->
   <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js"></script>
   <!-- MDB core JavaScript -->
   <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.5.9/js/mdb.min.js"></script>
   <script type="text/javascript">
   $(document).ready(function() {
     
     // restore memory
     $(this).find('input[type="email"]').val(localStorage.getItem('email'));
     $(this).find('textarea').val(localStorage.getItem('src'));
     if (localStorage.getItem('prob-id')) {
       $(this).find('.prob-select').val(localStorage.getItem('prob-id'));
     }
     if (localStorage.getItem('lang-id')) {
       $(this).find('.lang-select').val(localStorage.getItem('lang-id'));   
     }
     
     // $('form input, form textarea, form select').on('click', function(){
     //   $('.submit-button').attr('disabled', false);
     //   $('form').css('opacity', 1);
     // });
     
     $('form').submit(function() {
       var email = this.email.value;
       
       if (/@tul.cz\s*$/.test(email)) {
          $(this).find('input[type="email"]').removeClass('is-invalid');
          // savae to local storage
          localStorage.setItem('email', $(this).find('input[type="email"]').val());
          localStorage.setItem('src', $(this).find('textarea').val());
          localStorage.setItem('prob-id', $(this).find('.prob-select').val());
          localStorage.setItem('lang-id', $(this).find('.lang-select').val());
          
          $('.submit-button').attr('disabled', true);
          $('form').attr('disabled', true).addClass('disabled');
          $('form').css('opacity', 0.65);
          return true;
        } else {
          $(this).find('input[type="email"]').addClass('is-invalid').focus();
        }
       return false;
     });
     
     $('.prob-select').change(function(){
       $('.prob-desc').addClass('d-none');
       $('#desc-' + $(this).val()).removeClass('d-none');
     });
     $('.prob-select').trigger('change');
     
     // Vanilla javascript
     // window.addEventListener('popstate', function (e) {
     //     var state = e.state;
     //     if (state !== null) {
     //         console.log('sfoo');
     //     }
     // });
     
     $('textarea').keydown(function (e) {
      if (e.ctrlKey && e.keyCode == 13) {
        $('form').submit();
      }
    });
    
   });
   </script>
</html>